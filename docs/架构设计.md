# æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ—ï¸ æ•´ä½“æ¶æ„

æœ¬æ¨¡æ¿é‡‡ç”¨ç°ä»£åŒ–çš„ Electron åº”ç”¨æ¶æ„ï¼Œéµå¾ªå®‰å…¨æœ€ä½³å®è·µå’Œæ€§èƒ½ä¼˜åŒ–åŸåˆ™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Electron Application                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Main Process          â”‚  Preload Script  â”‚  Renderer Process â”‚
â”‚  (Node.js)            â”‚  (Bridge)        â”‚  (Chromium)       â”‚
â”‚                       â”‚                  â”‚                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ App Lifecycle   â”‚  â”‚  â”‚ Secure API  â”‚ â”‚  â”‚ Vue 3 App       â”‚ â”‚
â”‚  â”‚ Window Manager  â”‚  â”‚  â”‚ Bridge      â”‚ â”‚  â”‚ Router          â”‚ â”‚
â”‚  â”‚ IPC Handler     â”‚  â”‚  â”‚ Context     â”‚ â”‚  â”‚ Pinia Store     â”‚ â”‚
â”‚  â”‚ File System     â”‚  â”‚  â”‚ Isolation   â”‚ â”‚  â”‚ Components      â”‚ â”‚
â”‚  â”‚ Native APIs     â”‚  â”‚  â”‚             â”‚ â”‚  â”‚ Element Plus    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶
- **Electron 28.x**: è·¨å¹³å°æ¡Œé¢åº”ç”¨æ¡†æ¶
- **Vue 3**: ç°ä»£åŒ–çš„å‰ç«¯æ¡†æ¶
- **TypeScript**: ç±»å‹å®‰å…¨çš„ JavaScript
- **Vite**: å¿«é€Ÿçš„æ„å»ºå·¥å…·

### å¼€å‘å·¥å…·
- **electron-vite**: Electron ä¸“ç”¨çš„ Vite é…ç½®
- **Vue Router**: å•é¡µåº”ç”¨è·¯ç”±
- **Pinia**: çŠ¶æ€ç®¡ç†
- **Element Plus**: UI ç»„ä»¶åº“

### æµ‹è¯•æ¡†æ¶
- **Jest**: å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
- **Playwright**: E2E æµ‹è¯•å’Œ Electron åº”ç”¨æµ‹è¯•
- **@vue/test-utils**: Vue ç»„ä»¶æµ‹è¯•

### ä»£ç è´¨é‡
- **ESLint**: ä»£ç æ£€æŸ¥
- **Prettier**: ä»£ç æ ¼å¼åŒ–
- **Husky**: Git é’©å­
- **lint-staged**: æš‚å­˜æ–‡ä»¶æ£€æŸ¥

## ğŸ›ï¸ æ¶æ„åŸåˆ™

### 1. å®‰å…¨ç¬¬ä¸€
- **ä¸Šä¸‹æ–‡éš”ç¦»**: å¯ç”¨ `contextIsolation`
- **ç¦ç”¨ Node é›†æˆ**: æ¸²æŸ“è¿›ç¨‹ä¸­ç¦ç”¨ `nodeIntegration`
- **å®‰å…¨çš„ IPC**: é€šè¿‡é¢„åŠ è½½è„šæœ¬æš´éœ²æœ‰é™çš„ API
- **CSP ç­–ç•¥**: å†…å®¹å®‰å…¨ç­–ç•¥é˜²æŠ¤

### 2. æ€§èƒ½ä¼˜åŒ–
- **è¿›ç¨‹åˆ†ç¦»**: ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹èŒè´£åˆ†ç¦»
- **æ‡’åŠ è½½**: æŒ‰éœ€åŠ è½½æ¨¡å—å’Œç»„ä»¶
- **èµ„æºä¼˜åŒ–**: ä»£ç åˆ†å‰²å’Œå‹ç¼©
- **å†…å­˜ç®¡ç†**: åˆç†çš„èµ„æºé‡Šæ”¾

### 3. å¯ç»´æŠ¤æ€§
- **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œ
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript æ”¯æŒ
- **æµ‹è¯•è¦†ç›–**: å…¨é¢çš„æµ‹è¯•ç­–ç•¥
- **æ–‡æ¡£å®Œå–„**: è¯¦ç»†çš„å¼€å‘æ–‡æ¡£

### 4. å¯æ‰©å±•æ€§
- **æ’ä»¶åŒ–æ¶æ„**: æ”¯æŒåŠŸèƒ½æ‰©å±•
- **é…ç½®é©±åŠ¨**: çµæ´»çš„é…ç½®ç®¡ç†
- **æ ‡å‡†åŒ–**: ç»Ÿä¸€çš„å¼€å‘è§„èŒƒ

## ğŸ“ ç›®å½•ç»“æ„è®¾è®¡

### ä¸»è¿›ç¨‹ (src/main/)
```
src/main/
â”œâ”€â”€ index.ts              # åº”ç”¨å…¥å£ç‚¹
â”œâ”€â”€ config/               # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ app.ts           # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ window.ts        # çª—å£é…ç½®
â”‚   â””â”€â”€ env.ts           # ç¯å¢ƒå˜é‡
â”œâ”€â”€ services/            # ä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ window.ts        # çª—å£ç®¡ç†æœåŠ¡
â”‚   â”œâ”€â”€ menu.ts          # èœå•æœåŠ¡
â”‚   â””â”€â”€ updater.ts       # è‡ªåŠ¨æ›´æ–°æœåŠ¡
â”œâ”€â”€ handlers/            # IPC å¤„ç†å™¨
â”‚   â”œâ”€â”€ app.ts           # åº”ç”¨ç›¸å…³ IPC
â”‚   â””â”€â”€ file.ts          # æ–‡ä»¶æ“ä½œ IPC
â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
    â”œâ”€â”€ logger.ts        # æ—¥å¿—å·¥å…·
    â””â”€â”€ security.ts     # å®‰å…¨å·¥å…·
```

### é¢„åŠ è½½è„šæœ¬ (src/preload/)
```
src/preload/
â”œâ”€â”€ index.ts             # ä¸»é¢„åŠ è½½è„šæœ¬
â”œâ”€â”€ api/                 # API å®šä¹‰
â”‚   â”œâ”€â”€ app.ts          # åº”ç”¨ API
â”‚   â”œâ”€â”€ file.ts         # æ–‡ä»¶ API
â”‚   â””â”€â”€ system.ts       # ç³»ç»Ÿ API
â””â”€â”€ types/              # é¢„åŠ è½½ç±»å‹å®šä¹‰
    â””â”€â”€ index.ts
```

### æ¸²æŸ“è¿›ç¨‹ (src/renderer/)
```
src/renderer/
â”œâ”€â”€ main.ts              # Vue åº”ç”¨å…¥å£
â”œâ”€â”€ App.vue              # æ ¹ç»„ä»¶
â”œâ”€â”€ components/          # å¯å¤ç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ common/         # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ layout/         # å¸ƒå±€ç»„ä»¶
â”‚   â””â”€â”€ business/       # ä¸šåŠ¡ç»„ä»¶
â”œâ”€â”€ views/              # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ Home.vue
â”‚   â””â”€â”€ Settings.vue
â”œâ”€â”€ router/             # è·¯ç”±é…ç½®
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ stores/             # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ app.ts          # åº”ç”¨çŠ¶æ€
â”‚   â””â”€â”€ user.ts         # ç”¨æˆ·çŠ¶æ€
â”œâ”€â”€ composables/        # ç»„åˆå¼å‡½æ•°
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â””â”€â”€ assets/             # é™æ€èµ„æº
```

## ğŸ”„ æ•°æ®æµè®¾è®¡

### IPC é€šä¿¡æµç¨‹
```
Renderer Process          Preload Script           Main Process
     â”‚                         â”‚                        â”‚
     â”‚ 1. Call API             â”‚                        â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶                        â”‚
     â”‚                         â”‚ 2. Validate & Forward â”‚
     â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
     â”‚                         â”‚                        â”‚ 3. Process
     â”‚                         â”‚                        â”‚
     â”‚                         â”‚ 4. Return Result      â”‚
     â”‚                         â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚ 5. Receive Response     â”‚                        â”‚
     â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                        â”‚
```

### çŠ¶æ€ç®¡ç†æµç¨‹
```
Component â”€â”€â–¶ Action â”€â”€â–¶ Store â”€â”€â–¶ State â”€â”€â–¶ Component
    â–²                                              â”‚
    â”‚                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Reactive Update â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ›¡ï¸ å®‰å…¨æ¶æ„

### 1. è¿›ç¨‹éš”ç¦»
- ä¸»è¿›ç¨‹ï¼šå¤„ç†ç³»ç»Ÿçº§æ“ä½œ
- æ¸²æŸ“è¿›ç¨‹ï¼šå¤„ç† UI å’Œç”¨æˆ·äº¤äº’
- é¢„åŠ è½½è„šæœ¬ï¼šå®‰å…¨çš„ API æ¡¥æ¥

### 2. API ç™½åå•
```typescript
// é¢„åŠ è½½è„šæœ¬ä¸­çš„ API ç™½åå•
const allowedChannels = [
  'app:get-version',
  'app:quit',
  'window:minimize',
  'window:maximize',
  'file:read',
  'file:write'
]
```

### 3. è¾“å…¥éªŒè¯
```typescript
// IPC å‚æ•°éªŒè¯
function validateIpcArgs(channel: string, args: any[]): boolean {
  const schema = getChannelSchema(channel)
  return validateSchema(args, schema)
}
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 1. å¯åŠ¨ä¼˜åŒ–
- å»¶è¿ŸåŠ è½½éå…³é”®æ¨¡å—
- é¢„ç¼–è¯‘æ¨¡æ¿å’Œç»„ä»¶
- ä¼˜åŒ–èµ„æºåŠ è½½é¡ºåº

### 2. è¿è¡Œæ—¶ä¼˜åŒ–
- è™šæ‹Ÿæ»šåŠ¨å¤„ç†å¤§åˆ—è¡¨
- é˜²æŠ–å’ŒèŠ‚æµå¤„ç†é¢‘ç¹æ“ä½œ
- å†…å­˜æ³„æ¼æ£€æµ‹å’Œé¢„é˜²

### 3. æ„å»ºä¼˜åŒ–
- ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
- Tree Shaking ç§»é™¤æ— ç”¨ä»£ç 
- èµ„æºå‹ç¼©å’Œä¼˜åŒ–

## ğŸ§ª æµ‹è¯•æ¶æ„

### æµ‹è¯•é‡‘å­—å¡”
```
        E2E Tests
       /           \
    Integration Tests
   /                   \
  Unit Tests           Component Tests
```

### æµ‹è¯•ç­–ç•¥
- **å•å…ƒæµ‹è¯•**: æµ‹è¯•ç‹¬ç«‹çš„å‡½æ•°å’Œç±»
- **ç»„ä»¶æµ‹è¯•**: æµ‹è¯• Vue ç»„ä»¶çš„è¡Œä¸º
- **é›†æˆæµ‹è¯•**: æµ‹è¯•æ¨¡å—é—´çš„äº¤äº’
- **E2E æµ‹è¯•**: æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·æµç¨‹

## ğŸ“¦ æ„å»ºæ¶æ„

### æ„å»ºæµç¨‹
```
Source Code â”€â”€â–¶ TypeScript â”€â”€â–¶ Vite â”€â”€â–¶ electron-builder â”€â”€â–¶ Distributable
     â”‚              â”‚             â”‚            â”‚                    â”‚
     â”‚              â”‚             â”‚            â”‚                    â”‚
  .ts/.vue      Type Check    Bundle &     Package &           .exe/.dmg
   Files                      Optimize      Sign              /.AppImage
```

### è¾“å‡ºç»“æ„
```
dist/
â”œâ”€â”€ win-unpacked/           # Windows æœªæ‰“åŒ…ç‰ˆæœ¬
â”œâ”€â”€ mac/                    # macOS åº”ç”¨åŒ…
â”œâ”€â”€ linux-unpacked/         # Linux æœªæ‰“åŒ…ç‰ˆæœ¬
â”œâ”€â”€ your-app-1.0.0.exe     # Windows å®‰è£…åŒ…
â”œâ”€â”€ your-app-1.0.0.dmg     # macOS ç£ç›˜é•œåƒ
â””â”€â”€ your-app-1.0.0.AppImage # Linux AppImage
```

## ğŸ”§ é…ç½®ç®¡ç†

### ç¯å¢ƒé…ç½®
- **å¼€å‘ç¯å¢ƒ**: çƒ­é‡è½½ã€è°ƒè¯•å·¥å…·ã€è¯¦ç»†æ—¥å¿—
- **æµ‹è¯•ç¯å¢ƒ**: æ¨¡æ‹Ÿæ•°æ®ã€æµ‹è¯•å·¥å…·ã€è¦†ç›–ç‡
- **ç”Ÿäº§ç¯å¢ƒ**: ä¼˜åŒ–æ„å»ºã€é”™è¯¯æŠ¥å‘Šã€æ€§èƒ½ç›‘æ§

### é…ç½®å±‚çº§
```
Default Config â”€â”€â–¶ Environment Config â”€â”€â–¶ User Config â”€â”€â–¶ Runtime Config
```

## ğŸ”„ æ›´æ–°æœºåˆ¶

### è‡ªåŠ¨æ›´æ–°æµç¨‹
```
App Start â”€â”€â–¶ Check Update â”€â”€â–¶ Download â”€â”€â–¶ Install â”€â”€â–¶ Restart
    â”‚              â”‚              â”‚           â”‚           â”‚
    â”‚              â”‚              â”‚           â”‚           â”‚
 Current        Update         Background   Silent      New
 Version        Server         Download    Install    Version
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—çº§åˆ«
- **Error**: é”™è¯¯ä¿¡æ¯
- **Warn**: è­¦å‘Šä¿¡æ¯
- **Info**: ä¸€èˆ¬ä¿¡æ¯
- **Debug**: è°ƒè¯•ä¿¡æ¯

### æ€§èƒ½ç›‘æ§
- å¯åŠ¨æ—¶é—´ç›‘æ§
- å†…å­˜ä½¿ç”¨ç›‘æ§
- CPU ä½¿ç”¨ç›‘æ§
- ç”¨æˆ·æ“ä½œè¿½è¸ª

è¿™ä¸ªæ¶æ„è®¾è®¡ç¡®ä¿äº†åº”ç”¨çš„å®‰å…¨æ€§ã€æ€§èƒ½å’Œå¯ç»´æŠ¤æ€§ï¼Œä¸ºå¼€å‘é«˜è´¨é‡çš„ Electron åº”ç”¨æä¾›äº†åšå®çš„åŸºç¡€ã€‚
